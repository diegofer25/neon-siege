<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Tower Defense Shooter</title>
    <link rel="stylesheet" href="style/index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide:wght@400&family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <!-- HUD Elements -->
        <div id="hud">
            <div id="healthBar" class="hud-element">
                <div class="healthbar">
                    <div class="healthfill" id="healthFill"></div>
                </div>
                <span id="healthText">100/100</span>
            </div>
            <div id="defenseBar" class="hud-element" style="display: none;">
                <div class="defensebar">
                    <div class="defensefill" id="defenseFill"></div>
                </div>
                <span id="defenseText">0/0</span>
            </div>
            <div id="coinDisplay" class="coin-display">
                <span class="coin-icon">ü™ô</span>
                <span id="coinAmount" class="coin-amount">0</span>
            </div>
            <div id="waveCounter" class="hud-element">
                <span id="wave">Wave: 1</span>
            </div>
            <div id="settingsButton" class="hud-element">
                <button id="settingsBtn" title="Settings">‚öôÔ∏è</button>
            </div>
            <div id="statsDisplay" class="hud-element">
                <div class="stat-item">
                    <span class="stat-icon">‚öîÔ∏è</span>
                    <span class="stat-label">ATK:</span>
                    <span id="attackValue" class="stat-value">10</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">‚ö°</span>
                    <span class="stat-label">SPD:</span>
                    <span id="speedValue" class="stat-value">1.0x</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">‚ù§Ô∏è</span>
                    <span class="stat-label">HP REG:</span>
                    <span id="hpsValue" class="stat-value">0</span>
                </div>
                                <div class="stat-item">
                    <span class="stat-icon">üíö</span>
                    <span class="stat-label">DEF REG:</span>
                    <span id="regenValue" class="stat-value">0</span>
                </div>
            </div>
            
            <!-- Score Display -->
            <div id="scoreDisplay" class="score-display">
                <span id="scoreValue" class="score-value">0</span>
                <span id="scoreMultiplier" class="score-multiplier" style="display: none;">x1.0</span>
            </div>

            <!-- XP Bar -->
            <div id="xpBar" class="xp-bar">
                <div id="xpFill" class="xp-fill"></div>
                <span id="xpLevel" class="xp-level">Lv.1</span>
            </div>

            <!-- Combo Counter -->
            <div id="comboCounter" class="combo-counter" style="display: none;">
                <span id="comboLabel" class="combo-label">COMBO</span>
                <span id="comboCount" class="combo-count">0</span>
                <div class="combo-timer-bar">
                    <div id="comboTimerFill" class="combo-timer-fill"></div>
                </div>
            </div>

            <!-- Challenges -->
            <div id="challengeDisplay" class="challenge-display" style="display: none;"></div>

            <!-- Performance Statistics (only shown with ?stats=true) -->
            <div id="performanceStats" class="performance-stats" style="display: none;">
                <div class="perf-stat-item">
                    <span class="perf-label">FPS:</span>
                    <span id="fpsValue" class="perf-value">60</span>
                </div>
                <div class="perf-stat-item">
                    <span class="perf-label">Frame:</span>
                    <span id="frameTimeValue" class="perf-value">16ms</span>
                </div>
                <div class="perf-stat-item">
                    <span class="perf-label">Avg:</span>
                    <span id="avgFpsValue" class="perf-value">60</span>
                </div>
                <div class="perf-stat-item">
                    <span class="perf-label">Optimized:</span>
                    <span id="optimizedValue" class="perf-value">No</span>
                </div>
            </div>
        </div>

        <!-- Start Screen -->
        <div id="startScreen" class="overlay">
            <h1>NEON DEFENDER</h1>
            <p>Survive infinite waves of enemies</p>
            <p>Auto-targeting turret defense game</p>
            <p>Earn coins to buy power-ups between waves!</p>
            <div class="start-difficulty-row" aria-label="Difficulty">
                <span>Difficulty</span>
                <div class="start-difficulty-options" id="startDifficulty" role="radiogroup" aria-label="Select difficulty">
                    <button type="button" role="radio" class="start-difficulty-option" data-difficulty="easy" aria-checked="false" tabindex="-1">Easy</button>
                    <button type="button" role="radio" class="start-difficulty-option active" data-difficulty="normal" aria-checked="true" tabindex="0">Normal</button>
                    <button type="button" role="radio" class="start-difficulty-option" data-difficulty="hard" aria-checked="false" tabindex="-1">Hard</button>
                </div>
            </div>
            <button id="startBtn">CLICK TO START</button>
            <button id="loadSaveBtn" style="display: none;">LOAD LAST SAVE</button>
        </div>

        <!-- Settings Screen -->
        <div id="settingsModal" class="overlay">
            <div class="settings-panel">
                <h2>Settings</h2>
                <div class="settings-grid">
                    <label class="settings-row">
                        <span>Sound Effects</span>
                        <span class="settings-audio-control">
                            <input id="settingSoundVolume" type="range" min="0" max="100" step="1" value="30" aria-label="Sound effects volume">
                            <span id="settingSoundVolumeValue" class="settings-volume-value">30</span>
                        </span>
                    </label>
                    <label class="settings-row">
                        <span>Music</span>
                        <span class="settings-audio-control">
                            <input id="settingMusicVolume" type="range" min="0" max="100" step="1" value="20" aria-label="Music volume">
                            <span id="settingMusicVolumeValue" class="settings-volume-value">20</span>
                        </span>
                    </label>
                    <label class="settings-row">
                        <span>Screen Shake</span>
                        <span class="toggle-switch">
                            <input id="settingScreenShake" type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </span>
                    </label>
                    <label class="settings-row">
                        <span>Performance Mode</span>
                        <span class="toggle-switch">
                            <input id="settingPerformanceMode" type="checkbox">
                            <span class="toggle-slider"></span>
                        </span>
                    </label>
                    <label class="settings-row">
                        <span>Show FPS</span>
                        <span class="toggle-switch">
                            <input id="settingShowStats" type="checkbox">
                            <span class="toggle-slider"></span>
                        </span>
                    </label>
                    <label class="settings-row">
                        <span>Keybind Hints</span>
                        <span class="toggle-switch">
                            <input id="settingKeybindHints" type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </span>
                    </label>
                </div>
                <p id="keybindHintsText" class="settings-help">Keyboard: P pause/resume ‚Ä¢ Settings also pause the run.</p>
                <div class="settings-actions">
                    <button id="saveGameBtn">Save Game</button>
                    <button id="loadGameBtn">Load Save</button>
                    <button id="clearSaveBtn" class="danger">Delete Save</button>
                </div>
                <div class="settings-actions">
                    <button id="consentManageBtn" title="Privacy preferences">Privacy</button>
                    <button id="resetSettingsBtn">Reset Defaults</button>
                    <button id="closeSettingsBtn" class="primary">Close</button>
                </div>
            </div>
        </div>

        <!-- Consent Screen -->
        <div id="consentScreen" class="overlay">
            <div class="consent-panel">
                <h2>Privacy Preferences</h2>
                <p>Choose how your data is used for analytics and ads.</p>
                <p>You can change this anytime from Settings ‚Üí Privacy.</p>

                <div class="consent-options">
                    <label>
                        <input id="consentAnalytics" type="checkbox">
                        Allow analytics
                    </label>
                    <label>
                        <input id="consentAds" type="checkbox">
                        Allow ads
                    </label>
                    <label>
                        <input id="consentPersonalizedAds" type="checkbox">
                        Allow personalized ads
                    </label>
                </div>

                <div class="consent-actions">
                    <button id="consentEssentialBtn">Essential Only</button>
                    <button id="consentSaveBtn">Save Choices</button>
                    <button id="consentAcceptAllBtn" class="primary">Accept All</button>
                </div>

                <p class="consent-note">
                    Replace this placeholder URL before launch:
                    <a href="https://example.com/privacy-policy" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
                </p>
            </div>
        </div>

        <!-- Power-Up Modal -->
        <div id="powerUpModal" class="overlay">
            <div class="shop-container">
                <h2>Power-Up Shop</h2>
                <div class="shop-tabs">
                    <button class="tab-button active" data-tab="offense">‚öîÔ∏è OFFENSE</button>
                    <button class="tab-button" data-tab="defense">üõ°Ô∏è DEFENSE</button>
                    <button class="tab-button" data-tab="utility">‚ö° UTILITY</button>
                </div>
                <div class="shop-content">
                    <div class="shop-main">
                        <div id="powerUpCards" class="shop-cards-container">
                            <!-- Cards will be dynamically generated -->
                        </div>
                        <aside id="powerUpDetails" class="shop-details-panel" aria-live="polite">
                            <!-- Details will be dynamically generated -->
                        </aside>
                    </div>
                </div>
                <div class="shop-footer">
                    <button class="shop-reward-btn">Ad Boost (+50%)</button>
                    <button id="shopUndoBtn" class="shop-undo-btn">Undo Last Purchase</button>
                    <button class="shop-close-btn">Continue to Next Wave</button>
                </div>
            </div>
        </div>

        <div id="shopSkipConfirmOverlay" class="overlay">
            <div class="shop-skip-confirm-panel">
                <h2>Skip Shop Purchases?</h2>
                <p>You haven't bought any power-ups this wave.</p>
                <p>Are you sure you want to continue to the next wave?</p>
                <div class="shop-skip-confirm-actions">
                    <button id="shopSkipConfirmCancelBtn">Go Back</button>
                    <button id="shopSkipConfirmContinueBtn" class="primary">Continue Anyway</button>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOver" class="overlay">
            <h1>GAME OVER</h1>
            <div id="newRecordBanner" class="new-record" style="display: none;">NEW PERSONAL BEST!</div>
            <div class="game-over-stats">
                <div class="go-stat-row"><span>Wave Reached</span><span id="finalWave">0</span></div>
                <div class="go-stat-row"><span>Final Score</span><span id="finalScore">0</span></div>
                <div class="go-stat-row"><span>Best Combo</span><span id="finalCombo">0</span></div>
                <div class="go-stat-row"><span>Level Reached</span><span id="finalLevel">1</span></div>
            </div>
            <div id="nearMissInfo" class="near-miss" style="display: none;"></div>
            <button id="restoreFromAdBtn" style="display: none;">WATCH AD TO RESTORE SAVE</button>
            <button id="loadAfterGameOverBtn" style="display: none;">LOAD LAST SAVE</button>
            <button id="restartBtn">START AGAIN</button>
        </div>

        <!-- Achievement Toast -->
        <div id="achievementToast" class="achievement-toast">
            <span id="achievementIcon" class="achievement-icon"></span>
            <div class="achievement-text">
                <span class="achievement-label">ACHIEVEMENT UNLOCKED</span>
                <span id="achievementName" class="achievement-name"></span>
            </div>
        </div>

        <!-- Pause Screen -->
        <div id="pauseScreen" class="overlay">
            <h2>PAUSED</h2>
            <p>Press P to resume</p>
        </div>

        <div id="waveCountdown" class="wave-countdown" aria-live="polite" aria-atomic="true">
            <span id="waveCountdownText">3</span>
        </div>

        <!-- Floating Text Container -->
        <div id="floatingTexts"></div>
    </div>

    <script type="module" src="./js/main.js"></script>
</body>
</html>
